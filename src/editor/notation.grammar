// see https://github.com/lezer-parser/julia/blob/main/src/index.grammar
// lezer-generator ./src/editor/notation.grammar -o src/editor/notation.js


@precedence {
    immediate
    dot @left
    prefix
    postfix
    interp @left
    typeonlyascription @left
    typeascription @left
    coeff
    call
    power @left
    bitshift @left
    times @left
    plus @left
    range @left
    pipe @left
    pipeback @right
    contains @left
    arrow @right
    band @right
    bor @right
    ternary @right
    pair @right
    assign @right
    regular1
    right0 @right
    regular0
    regular-1
    right-2 @right
    regular-2
  }
  
  @top SourceFile {
    topLevelList | ""
  }
  
  @skip { Comment | BlockComment }
  
  // TOP LEVEL

  topLevelList{
    definition  | whitespace
  }
  
  
  
  // DEFINITIONS
  
  definition {
     InstrumentVoice
  }

  InstrumentVoice[closedBy="\n"] {
    Identifier ":" barList terminator
  }


  barList {
    whitespace* (Group (whitespace+ Group)* whitespace*)?
  }

  Group {
    groupMember+
  }

  groupMember {
    Chord | Tone | Duration | DurationSymbolic | Rest | SpecificRest | BarLine | OctaveSign
  }

  BarLine {
    "|" | "|:" | ":|" | "||" | "ğ„€" | "ğ„" | "ğ„‚" | "ğ„ƒ" | "ğ„„" | "ğ„…" | "ğ„†" | "ğ„‡"
  }

  Chord {
    "cmin"
  }

  Tone {
    Accidental? ToneInOctave ToneOctave?
  }

  // https://en.wikipedia.org/wiki/Musical_Symbols_(Unicode_block)
  ToneInOctave {
    "a"|"b"|"c"|"d"|"e"|"f"|"g"|"h"|"A"|"B"|"C"|"D"|"E"|"F"|"G"|"H"
  }

  OctaveSign {
    "o" Integer
  }

  ToneOctave {
   //( Integer) |
   (  ",")+ | 
   (  "'")+
  }
  
  Accidental {
    "+"|"++"|
    "-"|"--"|
    "â™­"|"â™¯"|"ğ„ª"|"ğ„«"|"ğ„­"|"ğ„¯"|"ğ„®"|"ğ„°"|"ğ„±"|"ğ„²"|"ğ„³"
  }

  Rest {
    "r" 
  }
  
  SpecificRest {
    ("ğ„º"|"ğ„»"|"ğ„¼"|"ğ„½"|"ğ„¾"|"ğ„¿"|"ğ…€"|"ğ…"|"ğ…‚") Dots?
  }

  DurationSymbolic {
    ("ğ…œ"|"ğ…"|"ğ…"|"â™©"|"â™ª"|"ğ…¡"|"ğ…¢"|"ğ…£"|"ğ…¤"|"â™¬"|"â™«") Dots?
  }

  Duration {
    ("0"|"1"|"2"|"4"|"8"|"16"|"6"|"32"|"3"|"64"|"128"|"256"|"512"|"1024") Dots?
  }

  Dots {
    (  ".")+
  }

  end { @specialize[@name=end,group="keyword"]<Identifier, "end"> }
  kw<term> { @specialize[@name={term},group="keyword"]<Identifier, term> }
  
  @external tokens terminator from "./tokens" { terminator }
  @external tokens Identifier from "./tokens" { Identifier }
  @external tokens BlockComment from "./tokens" { BlockComment }
  @external tokens stringContent from "./tokens" { stringContent }
  @external tokens layoutExtra from "./tokens" {
    immediateParen,
    immediateColon,
    immediateBrace,
    immediateBracket,
    immediateDoubleQuote,
    immediateBackquote,
    immediateDot,
    nowhitespace
  }
  
  @tokens {
    whitespace {
      " " | "\t" | "\n"
    }
    Comment {
      "#" ![\n]*
    }
    Integer {
      $[0-9] $[0-9_]*
    }
    Number {
      // not-integer
      (
        "0" $[xX] $[0-9a-fA-F] $[0-9a-fA-F_]* |
        $[0-9] $[0-9_]* "." ($[0-9] $[0-9_]*)? |
        "." $[0-9] $[0-9_]*
      )
      //($[eE] ("-" | "+")? $[0-9]+)?
    }
    powerOperator {
      "."? ("^" /*| "â†‘" | "â†“" | "â‡µ" | "âŸ°" | "âŸ±" | "â¤ˆ" | "â¤‰" | "â¤Š" | "â¤‹" | "â¤’" | "â¤“" | "â¥‰" | "â¥Œ" | "â¥" | "â¥" | "â¥‘" | "â¥”" | "â¥•" | "â¥˜" | "â¥™" | "â¥œ" | "â¥" | "â¥ " | "â¥¡" | "â¥£" | "â¥¥" | "â¥®" | "â¥¯" | "ï¿ª" | "ï¿¬"*/)
    }
    timesOperator {
      "."? ("*" | "/" | "Ã·" | "%" | "&" /*| "â‹…" | "âˆ˜" | "Ã—" | "\\" | "âˆ©" | "âˆ§" | "âŠ—" | "âŠ˜" | "âŠ™" | "âŠš" | "âŠ›" | "âŠ " | "âŠ¡" | "âŠ“" | "âˆ—" | "âˆ™" | "âˆ¤" | "â…‹" | "â‰€" | "âŠ¼" | "â‹„" | "â‹†" | "â‹‡" | "â‹‰" | "â‹Š" | "â‹‹" | "â‹Œ" | "â‹" | "â‹’" | "âŸ‘" | "â¦¸" | "â¦¼" | "â¦¾" | "â¦¿" | "â§¶" | "â§·" | "â¨‡" | "â¨°" | "â¨±" | "â¨²" | "â¨³" | "â¨´" | "â¨µ" | "â¨¶" | "â¨·" | "â¨¸" | "â¨»" | "â¨¼" | "â¨½" | "â©€" | "â©ƒ" | "â©„" | "â©‹" | "â©" | "â©" | "â©‘" | "â©“" | "â©•" | "â©˜" | "â©š" | "â©œ" | "â©" | "â©Ÿ" | "â© " | "â«›" | "âŠ" | "â–·" | "â¨" | "âŸ•" | "âŸ–" | "âŸ—"*/)
    }
    plusOperatorExtra {
      "|||" /*| "âŠ•" | "âŠ–" | "âŠ" | "âŠŸ" | "|++|" | "âˆª" | "âˆ¨" | "âŠ”" | "Â±" | "âˆ“" | "âˆ”" | "âˆ¸" | "â‰‚" | "â‰" | "âŠ" | "âŠ»" | "âŠ½" | "â‹" | "â‹“" | "â§º" | "â§»" | "â¨ˆ" | "â¨¢" | "â¨£" | "â¨¤" | "â¨¥" | "â¨¦" | "â¨§" | "â¨¨" | "â¨©" | "â¨ª" | "â¨«" | "â¨¬" | "â¨­" | "â¨®" | "â¨¹" | "â¨º" | "â©" | "â©‚" | "â©…" | "â©Š" | "â©Œ" | "â©" | "â©" | "â©’" | "â©”" | "â©–" | "â©—" | "â©›" | "â©" | "â©¡" | "â©¢" | "â©£"*/
    }
    arrowOperator {
      "--" | "-->" | "."?  ("â†" | "â†’" /*| "â†”" | "â†š" | "â†›" | "â†" | "â† " | "â†¢" | "â†£" | "â†¦" | "â†¤" | "â†®" | "â‡" | "â‡" | "â‡" | "â‡" | "â‡’" | "â‡”" | "â‡´" | "â‡¶" | "â‡·" | "â‡¸" | "â‡¹" | "â‡º" | "â‡»" | "â‡¼" | "â‡½" | "â‡¾" | "â‡¿" | "âŸµ" | "âŸ¶" | "âŸ·" | "âŸ¹" | "âŸº" | "âŸ»" | "âŸ¼" | "âŸ½" | "âŸ¾" | "âŸ¿" | "â¤€" | "â¤" | "â¤‚" | "â¤ƒ" | "â¤„" | "â¤…" | "â¤†" | "â¤‡" | "â¤Œ" | "â¤" | "â¤" | "â¤" | "â¤" | "â¤‘" | "â¤”" | "â¤•" | "â¤–" | "â¤—" | "â¤˜" | "â¤" | "â¤" | "â¤Ÿ" | "â¤ " | "â¥„" | "â¥…" | "â¥†" | "â¥‡" | "â¥ˆ" | "â¥Š" | "â¥‹" | "â¥" | "â¥" | "â¥’" | "â¥“" | "â¥–" | "â¥—" | "â¥š" | "â¥›" | "â¥" | "â¥Ÿ" | "â¥¢" | "â¥¤" | "â¥¦" | "â¥§" | "â¥¨" | "â¥©" | "â¥ª" | "â¥«" | "â¥¬" | "â¥­" | "â¥°" | "â§´" | "â¬±" | "â¬°" | "â¬²" | "â¬³" | "â¬´" | "â¬µ" | "â¬¶" | "â¬·" | "â¬¸" | "â¬¹" | "â¬º" | "â¬»" | "â¬¼" | "â¬½" | "â¬¾" | "â¬¿" | "â­€" | "â­" | "â­‚" | "â­ƒ" | "â­„" | "â­‡" | "â­ˆ" | "â­‰" | "â­Š" | "â­‹" | "â­Œ" | "ï¿©" | "ï¿«" | "â‡œ" | "â‡" | "â†œ" | "â†" | "â†©" | "â†ª" | "â†«" | "â†¬" | "â†¼" | "â†½" | "â‡€" | "â‡" | "â‡„" | "â‡†" | "â‡‡" | "â‡‰" | "â‡‹" | "â‡Œ" | "â‡š" | "â‡›" | "â‡ " | "â‡¢"*/)
    }
    bitshiftOperator {
      ">>" | "<<" | ">>>"
    }
    comparisonOperator {
      "|<:|" | "|>:|" | "."?  (">" | "<" | ">=" | "â‰¥" | "<=" | "â‰¤" | "==" | "===" /*| "â‰¡" | "!=" | "â‰ " | "!==" | "â‰¢" | "âˆˆ" | "âˆ‰" | "âˆ‹" | "âˆŒ" | "âŠ†" | "âŠˆ" | "âŠ‚" | "âŠ„" | "âŠŠ" | "âˆ" | "âˆŠ" | "âˆ" | "âˆ¥" | "âˆ¦" | "âˆ·" | "âˆº" | "âˆ»" | "âˆ½" | "âˆ¾" | "â‰" | "â‰ƒ" | "â‰‚" | "â‰„" | "â‰…" | "â‰†" | "â‰‡" | "â‰ˆ" | "â‰‰" | "â‰Š" | "â‰‹" | "â‰Œ" | "â‰" | "â‰" | "â‰" | "â‰‘" | "â‰’" | "â‰“" | "â‰–" | "â‰—" | "â‰˜" | "â‰™" | "â‰š" | "â‰›" | "â‰œ" | "â‰" | "â‰" | "â‰Ÿ" | "â‰£" | "â‰¦" | "â‰§" | "â‰¨" | "â‰©" | "â‰ª" | "â‰«" | "â‰¬" | "â‰­" | "â‰®" | "â‰¯" | "â‰°" | "â‰±" | "â‰²" | "â‰³" | "â‰´" | "â‰µ" | "â‰¶" | "â‰·" | "â‰¸" | "â‰¹" | "â‰º" | "â‰»" | "â‰¼" | "â‰½" | "â‰¾" | "â‰¿" | "âŠ€" | "âŠ" | "âŠƒ" | "âŠ…" | "âŠ‡" | "âŠ‰" | "âŠ‹" | "âŠ" | "âŠ" | "âŠ‘" | "âŠ’" | "âŠœ" | "âŠ©" | "âŠ¬" | "âŠ®" | "âŠ°" | "âŠ±" | "âŠ²" | "âŠ³" | "âŠ´" | "âŠµ" | "âŠ¶" | "âŠ·" | "â‹" | "â‹" | "â‹‘" | "â‹•" | "â‹–" | "â‹—" | "â‹˜" | "â‹™" | "â‹š" | "â‹›" | "â‹œ" | "â‹" | "â‹" | "â‹Ÿ" | "â‹ " | "â‹¡" | "â‹¢" | "â‹£" | "â‹¤" | "â‹¥" | "â‹¦" | "â‹§" | "â‹¨" | "â‹©" | "â‹ª" | "â‹«" | "â‹¬" | "â‹­" | "â‹²" | "â‹³" | "â‹´" | "â‹µ" | "â‹¶" | "â‹·" | "â‹¸" | "â‹¹" | "â‹º" | "â‹»" | "â‹¼" | "â‹½" | "â‹¾" | "â‹¿" | "âŸˆ" | "âŸ‰" | "âŸ’" | "â¦·" | "â§€" | "â§" | "â§¡" | "â§£" | "â§¤" | "â§¥" | "â©¦" | "â©§" | "â©ª" | "â©«" | "â©¬" | "â©­" | "â©®" | "â©¯" | "â©°" | "â©±" | "â©²" | "â©³" | "â©µ" | "â©¶" | "â©·" | "â©¸" | "â©¹" | "â©º" | "â©»" | "â©¼" | "â©½" | "â©¾" | "â©¿" | "âª€" | "âª" | "âª‚" | "âªƒ" | "âª„" | "âª…" | "âª†" | "âª‡" | "âªˆ" | "âª‰" | "âªŠ" | "âª‹" | "âªŒ" | "âª" | "âª" | "âª" | "âª" | "âª‘" | "âª’" | "âª“" | "âª”" | "âª•" | "âª–" | "âª—" | "âª˜" | "âª™" | "âªš" | "âª›" | "âªœ" | "âª" | "âª" | "âªŸ" | "âª " | "âª¡" | "âª¢" | "âª£" | "âª¤" | "âª¥" | "âª¦" | "âª§" | "âª¨" | "âª©" | "âªª" | "âª«" | "âª¬" | "âª­" | "âª®" | "âª¯" | "âª°" | "âª±" | "âª²" | "âª³" | "âª´" | "âªµ" | "âª¶" | "âª·" | "âª¸" | "âª¹" | "âªº" | "âª»" | "âª¼" | "âª½" | "âª¾" | "âª¿" | "â«€" | "â«" | "â«‚" | "â«ƒ" | "â«„" | "â«…" | "â«†" | "â«‡" | "â«ˆ" | "â«‰" | "â«Š" | "â«‹" | "â«Œ" | "â«" | "â«" | "â«" | "â«" | "â«‘" | "â«’" | "â«“" | "â«”" | "â«•" | "â«–" | "â«—" | "â«˜" | "â«™" | "â«·" | "â«¸" | "â«¹" | "â«º" | "âŠ¢" | "âŠ£" | "âŸ‚"*/)
    }
    assignOperator {
      ":=" | "~" | "$=" | "."? ("=" | "+=" | "-=" | "*=" | "/=" /*| "//=" | "|=|" | "^=" | "Ã·=" | "%=" | "<<=" | ">>=" | ">>>=" | "||=|" | "&=" | "âŠ»=" | "â‰”" | "â©´" | "â‰•"*/)
    }
    unaryOperatorExtra {
      ">:" | "!" | "~" | "Â¬" | "âˆš" | "âˆ›" | "âˆœ"
    }
    plusminus {
      "+" | "-"
    }
    ternary1 {
      whitespace+ "?" whitespace+
    }
    ternary2 {
      whitespace+ ":" whitespace+
    }
    @precedence {
      Integer,
      Number,
      comparisonOperator,
      "=",
      assignOperator,
      unaryOperatorExtra,
      plusOperatorExtra,
      ".",
      ternary1,
      ternary2,
      whitespace
    }
  }